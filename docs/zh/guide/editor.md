# 故事编辑器

Naninovel 拥有自己独立的应用程序，您可以使用它通过可视化编辑器创作剧本脚本，并通过节点图管理故事结构，同时在 Unity 编辑器中制作游戏。您还可以使用它来创建剧本草稿，并使用程序生成的资产在 Web 浏览器中预览它，甚至无需打开 Unity。

![](https://i.gyazo.com/fa644485a2eeffd9ab67605176fa873e.png)

## 沙盒模式

沙盒模式完全独立于 Unity 编辑器。它提供了在浏览器中直接创作剧本和预览（播放）游戏的工具，使用最新的引擎规格、可用命令和运行时功能。在底层，它生成标准的 `.nani` 文本文件，您可以在 Unity 中无缝重用或使用 [VS Code](/zh/guide/ide-extension) 直接编辑。

沙盒模式的主要用例：

- 在购买前试用 Naninovel 的脚本系统和运行时功能；
- 在开始 Unity 开发之前，使用生成的资产起草剧本。

导航到 [naninovel.com/editor](https://naninovel.com/editor) 并直接在您的 Web 浏览器中开始使用该应用程序。或者，接受浏览器提示将该应用程序安装为 [PWA](https://en.wikipedia.org/wiki/Progressive_web_app)，以便它在任务栏上有自己的专用图标，并在本机 OS 窗口中运行，就像常规桌面应用程序一样。

![?width=500](https://i.gyazo.com/71a9d721eb851db02feca366c0810bdb.png)

### 占位符资产

在起草故事时，使用媒体资产的临时版本（例如音频剪辑、背景和角色纹理）可能会很有用。同时，在预览剧本时跟踪当前处于活动状态的资产也很有帮助。

沙盒模式允许创建占位符资产，您可以描述资产特征，编辑器会生成可区分的预览以在资产使用时显示。

![](https://i.gyazo.com/fd6765bfc35024769871e4d9b1372b62.png)

要创建占位符资产，请在 [文件浏览器](/zh/guide/editor#文件浏览器) 中的 `Backgrounds`、`Characters` 或 `Audio` 目录下右键单击，然后选择添加关联资产的选项。

然后，您可以选择创建的资产来检查和编辑可用特征。

![?width=604](https://i.gyazo.com/b876cb9f3305899a8fc880cac89b3702.png)

创建的资产会自动添加到 [剧本编辑器](/zh/guide/editor#剧本编辑器) 的下拉列表中。

![?width=453](https://i.gyazo.com/01cc5ad5e5edb81b9b26a81b454f411f.png)

选中后，资产会立即显示在游戏预览中。

## 嵌入模式

故事编辑器与 Unity 编辑器完全集成，可以通过检查剧本脚本资产或通过 `Naninovel -> Story Editor` Unity 编辑器菜单启动。

![?width=588](https://i.gyazo.com/48ad8d4c512b67df02d7ace15d5eaca5.png)

首次启动故事编辑器时，需要 Internet 连接来下载编辑器应用程序二进制文件；二进制文件会被缓存，因此同一项目中的后续运行不需要网络。

## 工作区

编辑器工作区具有灵活且可自定义的布局。您可以通过拖放选项卡、选项卡集或选项卡本身之间的分隔线来调整任何选项卡的大小或重新定位。您还可以通过单击关联选项卡集末尾的按钮来最大化任何选项卡。

![?width=469](https://i.gyazo.com/4317e0bd0d87b270feb756c55ebace62.mp4)

有默认布局模板可供选择，您可以通过控制面板上的下拉菜单添加自定义布局。

![?width=310](https://i.gyazo.com/8cab94936284761b432dc0f271cb1d12.png)

## 文件浏览器

文件浏览器选项卡允许您与当前项目根目录下的文件和目录进行交互。您可以创建新的剧本脚本或占位符资产（在 [沙盒模式](/zh/guide/editor#沙盒模式) 下），管理和组织文件。

![?width=280](https://i.gyazo.com/ada798d90c52c3f24d88001258e794a1.png)

当您通过文件浏览器重命名或移动剧本脚本文件时，编辑器会自动更新导航命令（例如 [@goto] 和 [@gosub]）以保持路径相关。

## 检查器

Naninovel 编辑器的交互模型类似于 Unity 编辑器：您选择一个资产，例如文件浏览器中的文件或故事图中的节点，关联的编辑器将显示在检查器选项卡中。这允许在结构编辑上下文和直接编辑上下文之间进行清晰的分离，从而产生更高效的用户体验。

![?width=606](https://i.gyazo.com/1bf3dae6c1bb254c05580e61300d064b.png)

检查器采用焦点陷阱 — 您可以使用 Tab 和 Shift+Tab 在输入字段和控件之间高效切换，而无需使用鼠标。

## 剧本编辑器

剧本编辑器是应用程序的主要创作工具。它是在文本或代码编辑器（如 VS Code）中编写 `.nani` 文件的替代方案。

![](https://i.gyazo.com/1e38f673835584033e4a5142f9989981.png)

每个剧本编辑器选项卡代表一个 `.nani` 脚本，文本行显示为行。您可以使用选项卡底部的 `+` 按钮、上下文菜单（右键单击现有内容）或 `Enter` 热键（可在 [设置](/zh/guide/editor#键位映射keymap) 中配置）添加行。

您可以通过拖放重新排序行，通过上下文菜单或使用 `Backspace` 和 `Ctrl+D` 键删除或复制行。

更改会立即应用，如果编辑的脚本当前正在播放，则会反映在游戏视图中。要保留更改，您需要 [保存](/zh/guide/editor#脏保存dirty-save) 修改后的文件。

在游戏运行时，当前播放的行会根据是否正在等待输入而以绿色或黄色轮廓突出显示。要自动打开当前播放的脚本并选择活动行，请单击控制面板上的专用按钮或按 `Ctrl+X`。

![?width=293](https://i.gyazo.com/4e2503fde65d327b2388ec5289814aae.png)

## 故事图

故事图有助于可视化、跟踪和组织剧本结构，还允许编辑脚本本身。

默认情况下，每个节点代表一个剧本脚本或目录。边缘代表脚本之间的导航。条件导航（例如 [@choice] 或 [@if] 下的 [@goto]）显示为虚线边缘，条件列在关联端口上。

![](https://i.gyazo.com/046b9f276e63914d4cdd8663f649d1e0.png)

您可以通过右键单击图形窗格来创建脚本和目录，并通过节点上下文菜单移动或重命名它们。要导航目录节点，请双击或从上下文菜单中选择 "Enter Folder"。

您还可以进入脚本节点，在这种情况下，图形作为可视化剧本编辑器工作。您将看到标签节点，而不是脚本和目录节点，这些节点承载的剧本行可以像在 [剧本编辑器](/zh/guide/editor#剧本编辑器) 中一样进行编辑。

![](https://i.gyazo.com/890d2edc13a971407620a3bd38d50573.png)

## 脏保存（Dirty-Save）

当您修改资产（例如剧本脚本或图形）时，它会变为 "dirty"（脏）— 意味着更改在内存中但尚未保存到磁盘。要保留更改，您需要保存资产。

![?width=323](https://i.gyazo.com/f8f63d99a51616da0fcf454def5fe667.png)

当至少有一个资产为脏时，保存按钮将变为活动状态。单击它以查看哪些资产已修改，并全部或单独保存它们。您也可以按 `Ctrl+S` 保存所有脏资产。

## 撤销-重做（Undo-Redo）

编辑器中的大多数修改都会被跟踪，并可以使用撤销-重做系统进行还原。进行更改后，撤销按钮将变为活动状态 — 单击它以查看更改列表并单独撤销/重做它们。

![?width=357](https://i.gyazo.com/7a2f120c4ce517eef9a804627d89c185.png)

您也可以分别使用 `Ctrl+Z` 和 `Ctrl+Y` 进行撤销和重做。

## 全局搜索

随着项目的增长，在所有剧本脚本中进行搜索可能会很有用。双击 `Shift` 键或单击控制面板上的 "Search" 按钮以打开全局搜索。

![?width=452](https://i.gyazo.com/bda71c03e4911f12a3dbbc8ce8214380.mp4)

结果随键入更新，包括剧本脚本名称和内容。选择结果会打开它并在 [剧本编辑器](/zh/guide/editor#剧本编辑器) 中突出显示关联行。

## 设置

您可以通过设置选项卡自定义编辑器和项目，该选项卡有两个主要类别：用户和项目。通过控制面板上的菜单或按 `Ctrl+Alt+S` 打开该选项卡。

![?width=470](https://i.gyazo.com/5bc5768a9b8f80fa42be00200bc06159.png)

### 用户设置

用户设置存储在您在沙盒模式下的首次设置期间选择的目录中，或存储在嵌入模式下的 Unity 持久目录下。它们不与项目共享，并适用于设备上的所有项目。这包括编辑器配色方案、键位映射和 UI 元素可见性等首选项。

### 项目设置

项目设置与用户无关，存储在项目目录下，并与从事该项目的所有用户共享。其中包括项目标题等项目特定属性。

### 键位映射（Keymap）

键位映射是用户设置的一部分，允许您为各种编辑器功能配置键绑定，例如追加行、复制节点、进入播放模式等。

要绑定键，请找到所需的操作并输入键代码。可以使用 `+` 前置修饰符。有关有效键代码和修饰符，请参阅 [MDN 参考](https://developer.mozilla.org/en-US/docs/Web/API/UI_Events/Keyboard_event_key_values)。

在 macOS 上，修饰符映射如下：

| 代码    | macOS |
|---------|-------|
| `Ctrl`  | `⌘`   |
| `Alt`   | `⌥`   |
| `Shift` | `⇧`   |
