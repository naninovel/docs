# ストーリーエディタ

Naninovelには独自のスタンドアロンアプリがあり、Unityエディタ内でゲームを制作しながら、ビジュアルエディタでシナリオスクリプトを作成したり、ノードグラフでストーリー構造を管理したりできます。また、Unityを開かずに、プロシージャル生成されたアセットを使用してシナリオのドラフトを作成し、Webブラウザでプレビューすることもできます。

![](https://i.gyazo.com/fa644485a2eeffd9ab67605176fa873e.png)

## サンドボックスモード

サンドボックスモードは、Unityエディタから完全に独立しています。最新のエンジンスペック、利用可能なコマンド、ランタイム機能を使用して、ブラウザで直接シナリオを作成し、ゲームをプレビュー（プレイ）するためのツールを提供します。内部的には標準の `.nani` テキストファイルを生成するため、Unityでシームレスに再利用したり、[VS Code](/ja/guide/ide-extension) で直接編集したりできます。

サンドボックスモードの主な使用例：

- 購入前にNaninovelのスクリプトシステムとランタイム機能を試す
- Unityで開発を始める前に、生成されたアセットを使用してシナリオのドラフトを作成する

[naninovel.com/editor](https://naninovel.com/editor) に移動して、Webブラウザ内で直接アプリの使用を開始します。オプションで、ブラウザのプロンプトを受け入れてアプリを [PWA](https://en.wikipedia.org/wiki/Progressive_web_app) としてインストールすると、通常のデスクトップアプリのようにタスクバーに専用のアイコンが表示され、ネイティブOSウィンドウで実行されます。

![?width=500](https://i.gyazo.com/71a9d721eb851db02feca366c0810bdb.png)

### プレースホルダーアセット

ストーリーのドラフトを作成する際、オーディオクリップ、背景、キャラクターテクスチャなどのメディアアセットの一時的なバージョンを使用すると便利な場合があります。同時に、シナリオをプレビューしながら、どのアセットが現在アクティブであるかを追跡するのにも役立ちます。

サンドボックスモードでは、プレースホルダーアセットを作成できます。アセットの特性を記述すると、アセットが使用されるときに表示される識別可能なプレビューがエディタによって生成されます。

![](https://i.gyazo.com/fd6765bfc35024769871e4d9b1372b62.png)

プレースホルダーアセットを作成するには、[ファイルブラウザ](/ja/guide/editor#ファイルブラウザ) の `Backgrounds`、`Characters`、または `Audio` ディレクトリの下で右クリックし、関連するアセットを追加するオプションを選択します。

作成したアセットを選択して、利用可能な特性を検査および編集できます。

![?width=604](https://i.gyazo.com/b876cb9f3305899a8fc880cac89b3702.png)

作成されたアセットは、[シナリオエディタ](/ja/guide/editor#シナリオエディタ) のドロップダウンリストに自動的に追加されます。

![?width=453](https://i.gyazo.com/01cc5ad5e5edb81b9b26a81b454f411f.png)

アセットを選択すると、ゲームプレビューに即座に表示されます。

## 組み込みモード

ストーリーエディタはUnityエディタと完全に統合されており、シナリオスクリプトアセットを検査するか、`Naninovel -> Story Editor` Unityエディタメニューから起動できます。

![?width=588](https://i.gyazo.com/48ad8d4c512b67df02d7ace15d5eaca5.png)

ストーリーエディタを初めて起動するときは、エディタアプリケーションのバイナリをダウンロードするためにインターネット接続が必要です。バイナリはキャッシュされるため、同じプロジェクトでのその後の実行にはネットワークは必要ありません。

## ワークスペース

エディタワークスペースには、柔軟でカスタマイズ可能なレイアウトがあります。タブ、タブセット、またはタブ自体の間の仕切りをドラッグアンドドロップすることで、任意のタブのサイズを変更したり位置を変更したりできます。関連するタブセットの最後にあるボタンをクリックして、任意のタブを最大化することもできます。

![?width=469](https://i.gyazo.com/4317e0bd0d87b270feb756c55ebace62.mp4)

選択できるデフォルトのレイアウトテンプレートがあり、コントロールパネルのドロップダウンからカスタムレイアウトを追加できます。

![?width=310](https://i.gyazo.com/8cab94936284761b432dc0f271cb1d12.png)

## ファイルブラウザ

ファイルブラウザタブを使用すると、現在のプロジェクトルート下のファイルとディレクトリを操作できます。新しいシナリオスクリプトやプレースホルダーアセットを作成したり（[サンドボックスモード](/ja/guide/editor#サンドボックスモード)）、ファイルを管理および整理したりできます。

![?width=280](https://i.gyazo.com/ada798d90c52c3f24d88001258e794a1.png)

ファイルブラウザを介してシナリオスクリプトファイルの名前を変更または移動すると、エディタはナビゲーションコマンド（[@goto] や [@gosub] など）を自動的に更新して、パスの整合性を維持します。

## インスペクター

NaninovelエディタのインタラクションモデルはUnityエディタに似ています。ファイルブラウザ内のファイルやストーリーグラフ内のノードなどのアセットを選択すると、関連するエディタがインスペクタータブに表示されます。これにより、構造的な編集コンテキストと直接的な編集コンテキストを明確に分離でき、生産性の高いUXが実現します。

![?width=606](https://i.gyazo.com/1bf3dae6c1bb254c05580e61300d064b.png)

インスペクターはフォーカストラップを採用しており、TabキーとShift+Tabキーを使用して、マウスを使用せずに入力フィールドとコントロールを効率的に切り替えることができます。

## シナリオエディタ

シナリオエディタは、アプリの主要なオーサリングツールです。これは、VS Codeなどのテキストまたはコードエディタで `.nani` ファイルを作成する代わりになります。

![](https://i.gyazo.com/1e38f673835584033e4a5142f9989981.png)

各シナリオエディタタブは `.nani` スクリプトを表し、テキスト行が行として視覚化されます。タブの下部にある `+` ボタン、コンテキストメニュー（既存のコンテンツを右クリック）、または `Enter` ホットキー（[設定](/ja/guide/editor#キーマップ) で構成可能）を使用して行を追加できます。

ドラッグアンドドロップで行を並べ替えたり、コンテキストメニューまたは `Backspace` キーと `Ctrl+D` キーで行を削除または複製したりできます。

変更は即座に適用され、編集中のスクリプトが現在再生されている場合はゲームビューに反映されます。変更を永続化するには、変更されたファイルを [保存](/ja/guide/editor#変更の保存dirty-save) する必要があります。

ゲームの実行中、現在再生されている行は、入力を待機しているかどうかに応じて緑または黄色の枠線で強調表示されます。現在再生されているスクリプトを自動的に開いてアクティブな行を選択するには、コントロールパネルの専用ボタンをクリックするか、`Ctrl+X` を押します。

![?width=293](https://i.gyazo.com/4e2503fde65d327b2388ec5289814aae.png)

## ストーリーグラフ

ストーリーグラフは、シナリオ構造を視覚化、追跡、整理するのに役立ち、スクリプト自体の編集も可能にします。

デフォルトでは、各ノードはシナリオスクリプトまたはディレクトリのいずれかを表します。エッジはスクリプト間のナビゲーションを表します。条件付きナビゲーション（[@choice] や [@if] の下の [@goto] など）は破線のエッジとして表示され、条件は関連するポートに一覧表示されます。

![](https://i.gyazo.com/046b9f276e63914d4cdd8663f649d1e0.png)

グラフペインを右クリックしてスクリプトとディレクトリを作成し、ノードのコンテキストメニューから移動または名前を変更できます。ディレクトリノードをナビゲートするには、ダブルクリックするか、コンテキストメニューから「Enter Folder」を選択します。

スクリプトノードに入ることもできます。この場合、グラフは視覚的なシナリオエディタとして機能します。スクリプトノードとディレクトリノードの代わりに、[シナリオエディタ](/ja/guide/editor#シナリオエディタ) と同様に編集できるシナリオ行をホストするラベルノードが表示されます。

![](https://i.gyazo.com/890d2edc13a971407620a3bd38d50573.png)

## 変更の保存（Dirty-Save）

シナリオスクリプトやグラフなどのアセットを変更すると、それは「ダーティ」になります。つまり、変更はメモリ内にありますが、まだディスクに保存されていません。変更を永続化するには、アセットを保存する必要があります。

![?width=323](https://i.gyazo.com/f8f63d99a51616da0fcf454def5fe667.png)

少なくとも1つのアセットがダーティな場合、保存ボタンがアクティブになります。クリックすると、どのアセットが変更されたかを確認し、すべてまたは個別に保存できます。`Ctrl+S` を押して、すべてのダーティなアセットを保存することもできます。

## 元に戻す・やり直し（Undo-Redo）

エディタでのほとんどの変更は追跡され、アンドゥ・リドゥシステムを使用して元に戻すことができます。変更が行われると、アンドゥボタンがアクティブになります。クリックすると変更のリストが表示され、個別に元に戻したりやり直したりできます。

![?width=357](https://i.gyazo.com/7a2f120c4ce517eef9a804627d89c185.png)

`Ctrl+Z` と `Ctrl+Y` でそれぞれ元に戻す、やり直しを行うこともできます。

## グローバル検索

プロジェクトが大きくなるにつれて、すべてのシナリオスクリプトを検索すると便利です。`Shift` キーを2回押すか、コントロールパネルの「Search」ボタンをクリックして、グローバル検索を開きます。

![?width=452](https://i.gyazo.com/bda71c03e4911f12a3dbbc8ce8214380.mp4)

結果は入力時に更新され、シナリオスクリプト名とコンテンツの両方が含まれます。結果を選択するとそれが開き、[シナリオエディタ](/ja/guide/editor#シナリオエディタ) で関連する行が強調表示されます。

## 設定

設定タブを使用して、エディタとプロジェクトの両方をカスタマイズできます。設定タブには、ユーザーとプロジェクトの2つの主要なカテゴリがあります。コントロールパネルのメニューから、または `Ctrl+Alt+S` を押してタブを開きます。

![?width=470](https://i.gyazo.com/5bc5768a9b8f80fa42be00200bc06159.png)

### ユーザー設定

ユーザー設定は、サンドボックスモードでの初回セットアップ時に選択したディレクトリ、または組み込みモードのUnityの永続ディレクトリの下に保存されます。これらはプロジェクトと共有されず、デバイス上のすべてのプロジェクトに適用されます。これには、エディタの配色、キーマップ、UI要素の可視性などの設定が含まれます。

### プロジェクト設定

プロジェクト設定はユーザーに依存せず、プロジェクトディレクトリの下に保存され、プロジェクトで作業するすべてのユーザーと共有されます。これには、プロジェクトタイトルなどのプロジェクト固有のプロパティが含まれます。

### キーマップ

キーマップはユーザー設定の一部であり、行の追加、ノードの複製、プレイモードへの移行など、さまざまなエディタ機能のキーバインドを構成できます。

キーをバインドするには、目的のアクションを見つけてキーコードを入力します。修飾子は `+` を使用して前に付加できます。有効なキーコードと修飾子については、[MDNリファレンス](https://developer.mozilla.org/en-US/docs/Web/API/UI_Events/Keyboard_event_key_values) を参照してください。

macOSでは、修飾子は次のようにマップされます。

| コード | macOS |
|---------|-------|
| `Ctrl` | `⌘` |
| `Alt` | `⌥` |
| `Shift` | `⇧` |
